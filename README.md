# Gophermart ‚Äì –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

**Gophermart** ‚Äî —ç—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π —Å–æ–±–æ–π HTTP API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–∏—ë–º –∏ —É—á—ë—Ç –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–∫–∞–∑–æ–≤, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π —Ä–∞—Å—á—ë—Ç–∞ –±–æ–Ω—É—Å–æ–≤, –∞ —Ç–∞–∫–∂–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤.

## üì¶ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–∏—ë–º –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–∫–∞–∑–æ–≤
- –£—á—ë—Ç –∑–∞–∫–∞–∑–æ–≤ –∏ –±–æ–Ω—É—Å–æ–≤
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å
- –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –Ω–∞ –æ–ø–ª–∞—Ç—É –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

   ```bash
   git clone https://github.com/lekcrg/gophermart
   cd gophermart
   ```

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `.env`:

   ```bash
   cp .env.example .env
   ```

   –í `.env.example` —É–∂–µ —É–∫–∞–∑–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∏—Ö –ø–æ–¥ —Å–≤–æ—é –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î.

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [`goose`](https://github.com/pressly/goose?tab=readme-ov-file#install), –µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.

4. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

   ```bash
   goose up
   ```

5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

   ```bash
   go mod tidy
   ```

6. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

   ```bash
   cd cmd/gophermart
   go build .
   ./gophermart
   ```
   –∏–ª–∏:
   ```bash
   cd cmd/gophermart
   go run .
   ```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞. –ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `.env.example`. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã.

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è               | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                               |
|--------------------------|--------------------------------------------------------------------------|
| `IS_DEV`                 | –í–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–∑–Ω–∞—á–µ–Ω–∏–µ `true` –∏–ª–∏ `false`)                |
| `RUN_ADDRESS`            | –ê–¥—Ä–µ—Å –∑–∞–ø—É—Å–∫–∞ API-—Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `localhost:8000`)                |
| `POSTGRES_USER`          | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è PostgreSQL                                              |
| `POSTGRES_PASSWORD`      | –ü–∞—Ä–æ–ª—å PostgreSQL                                                        |
| `POSTGRES_HOST`          | –•–æ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ `localhost` –∏–ª–∏ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –≤ Docker)           |
| `POSTGRES_PORT`          | –ü–æ—Ä—Ç PostgreSQL (–æ–±—ã—á–Ω–æ `5432`)                                          |
| `POSTGRES_DB`            | –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö                                                     |
| `DATABASE_URI`           | –ü–æ–ª–Ω—ã–π URI –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω, —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é  |
| `ACCRUAL_SYSTEM_ADDRESS` | –ê–¥—Ä–µ—Å –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—á—ë—Ç–∞ –±–∞–ª–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `localhost:8000`)     |
| `JWT_SECRET_KEY`         | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤ (–ó–ê–ú–ï–ù–ò–¢–ï –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é!)         |
| `JWT_TOKEN_EXP`          | –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `30m`, `1h`, `24h`)                 |
| `GOOSE_DRIVER`           | –î—Ä–∞–π–≤–µ—Ä –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `postgres` ‚Äî –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ          |
| `GOOSE_DBSTRING`         | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è goose                               |
| `GOOSE_MIGRATION_DIR`    | –ü—É—Ç—å –¥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ goose, –ª—É—á—à–µ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –≤ .env.example |

> ‚ö†Ô∏è –ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–¥–∞–¥–∏—Ç–µ `DATABASE_URI`, —Ç–æ URI –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±—Ä–∞–Ω –∏–∑ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

> üîê –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `JWT_SECRET_KEY` –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º.

## ‚úÖ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ –Ø–Ω–¥–µ–∫—Å –ü—Ä–∞–∫—Ç–∏–∫—É–º–∞

1. –°–∫–∞—á–∞–π—Ç–µ `statictest` –∏ `gophermarttest` –ø–æ–¥ –≤–∞—à—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (x64, arm64 –∏ —Ç.–¥.)
2. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –æ–±–∞ —Ñ–∞–π–ª–∞ –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –≤ `~/go/bin`:

   ```bash
   mv statictest ~/go/bin/statictest
   mv gophermarttest ~/go/bin/gophermarttest
   chmod +x ~/go/bin/statictest ~/go/bin/gophermarttest
   ```

3. –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞:

   ```bash
   chmod +x test.sh
   ```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

   ```bash
   ./test.sh
   ```

## üõ† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Go** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–µ–∫—Ç–∞
- **PostgreSQL** ‚Äî —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Goose** ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **Chi** ‚Äî –ª—ë–≥–∫–∏–π –∏ –±—ã—Å—Ç—Ä—ã–π HTTP-—Ä–æ—É—Ç–µ—Ä
- **Koanf** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `.env`, —Ñ–ª–∞–≥–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **Swaggo** ‚Äî –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API
- **JWT** ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é —Ç–æ–∫–µ–Ω–æ–≤
- **Resty** ‚Äî HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–æ–º —Ä–∞—Å—á—ë—Ç–∞ –±–∞–ª–ª–æ–≤

<!-- 
## üìñ Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–í –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:  
üëâ [https://gophermart.rmnv.dev/swagger](https://gophermart.rmnv.dev/swagger)
-->

---

> –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –æ–±—É—á–µ–Ω–∏—è –≤ –Ø–Ω–¥–µ–∫—Å.–ü—Ä–∞–∫—Ç–∏–∫—É–º–µ.


## üßÆ –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á—ë—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π (accrual)

–í –ø—Ä–æ–µ–∫—Ç –≤—Ö–æ–¥–∏—Ç —Å–∏–º—É–ª—è—Ç–æ—Ä –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—á—ë—Ç–∞ –±–∞–ª–ª–æ–≤ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª. –û–Ω –∏–º–∏—Ç–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞—Å—Ç–æ—è—â–µ–π —Å–∏—Å—Ç–µ–º—ã, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º –ø–æ HTTP.

### üìÇ –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤

–ë–∏–Ω–∞—Ä–Ω–∏–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `cmd/accrual` –∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:

- `accrual_darwin_amd64`
- `accrual_darwin_arm64`
- `accrual_linux_amd64`
- `accrual_windows_amd64`

–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è –≤–∞—à–µ–π –û–° –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

### ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ —Ä–∞—Å—á—ë—Ç–∞

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –±–∏–Ω–∞—Ä–Ω–∏–∫ –∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –ü—Ä–∏–º–µ—Ä –¥–ª—è Linux
./cmd/accrual/accrual_linux_amd64
```

–ò–ª–∏ —Å —Ñ–ª–∞–≥–∞–º–∏:

```bash
./cmd/accrual/accrual_linux_amd64 -a=localhost:8080 -d=postgres://user:pass@localhost:5432/dbname
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `RUN_ADDRESS` ‚Äî –∞–¥—Ä–µ—Å –∑–∞–ø—É—Å–∫–∞ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `localhost:8080`)
- `DATABASE_URI` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- `ACCRUAL_SYSTEM_ADDRESS` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–∏–º—É–ª—è—Ç–æ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://localhost:8080`)

> üí° –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

### üîó API —Å–∏–º—É–ª—è—Ç–æ—Ä–∞

–°–∏–º—É–ª—è—Ç–æ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç:

- `GET /api/orders/{number}` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–∞ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞.

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –æ—Ç–≤–µ—Ç–∞**:

- `200 OK` ‚Äî —Ä–∞—Å—á—ë—Ç –ø—Ä–æ–∏–∑–≤–µ–¥—ë–Ω, –≤–æ–∑–º–æ–∂–µ–Ω –æ—Ç–≤–µ—Ç:
  ```json
  {
      "order": "12345678903",
      "status": "PROCESSED",
      "accrual": 500
  }
  ```
- `204 No Content` ‚Äî –∑–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω
- `429 Too Many Requests` ‚Äî –ø—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∑–∂–µ
- `500 Internal Server Error` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–∏—Å–∞

> ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å—ã `INVALID` –∏ `PROCESSED` —è–≤–ª—è—é—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–º–∏. –†–∞—Å—á—ë—Ç –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

---

